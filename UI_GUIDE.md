# 用户界面指南 / User Interface Guide

## 应用界面概述 / Application UI Overview

ABB Robot Program Reader 采用 Material Design 3 设计，提供直观且美观的用户体验。

## 主界面组件 / Main Interface Components

### 1. 工具栏 (Toolbar)
```
┌─────────────────────────────────────┐
│  ABB Robot Program Reader           │
└─────────────────────────────────────┘
```
- **位置**: 屏幕顶部
- **功能**: 显示应用标题
- **颜色**: ABB 红色 (#FF0000)
- **文字颜色**: 白色

### 2. 文件选择按钮 (File Selection Button)
```
┌─────────────────────────────────────┐
│  📤  选择 ABB 程序文件               │
└─────────────────────────────────────┘
```
- **样式**: Material Button (Elevated)
- **功能**: 打开系统文件选择器
- **支持格式**: .mod, .prg, .sys, .pgf
- **交互**: 点击打开文件浏览器

### 3. 文件信息区 (File Information)
```
┌─────────────────────────────────────┐
│ sample_program.mod                  │
│ 文件类型: MOD                        │
└─────────────────────────────────────┘
```
- **显示内容**:
  - 文件名
  - 文件类型
- **字体**: 粗体，16sp
- **默认文本**: "未选择文件"

### 4. 模块卡片 (Modules Card)
```
┌─────────────────────────────────────┐
│ 模块                                │
│ ┌─────────────────────────────────┐ │
│ │ MainModule                      │ │
│ │ 类型: NOSTEPIN, 例行程序: 5,    │ │
│ │ 变量: 8                          │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ PickAndPlace                    │ │
│ │ 类型: NOSTEPIN, 例行程序: 6,    │ │
│ │ 变量: 12                         │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```
- **样式**: Material CardView
- **圆角**: 8dp
- **阴影**: 4dp elevation
- **布局**: RecyclerView (垂直列表)
- **项目样式**: 带边框的小卡片

### 5. 例行程序卡片 (Routines Card)
```
┌─────────────────────────────────────┐
│ 例行程序                            │
│ ┌─────────────────────────────────┐ │
│ │ main                            │ │
│ │ 类型: PROC, 参数: 0, 行: 23-45  │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ initialize_robot                │ │
│ │ 类型: PROC, 参数: 0, 行: 48-55  │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ calculate_value                 │ │
│ │ 类型: FUNC, 参数: 2, 行: 89-98  │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```
- **功能**: 点击可查看该例行程序的代码
- **显示信息**:
  - 例行程序名称
  - 类型 (PROC/FUNC/TRAP)
  - 参数数量
  - 代码行范围

### 6. 代码内容卡片 (Code Content Card)
```
┌─────────────────────────────────────┐
│ 文件内容                            │
│ ┌─────────────────────────────────┐ │
│ │ MODULE MainModule               │ │
│ │     VAR num counter := 0;       │ │
│ │     PERS robtarget home := [...│ │
│ │                                 │ │
│ │     PROC main()                 │ │
│ │         counter := 0;           │ │
│ │         WHILE counter < 10 DO   │ │
│ │             MoveJ home, v1000...│ │
│ │             WaitTime 1;         │ │
│ │         ENDWHILE                │ │
│ │     ENDPROC                     │ │
│ │ ENDMODULE                       │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```
- **背景色**: 浅灰色 (#F5F5F5)
- **字体**: 等宽字体 (monospace)
- **字号**: 14sp
- **行间距**: 4dp
- **水平滚动**: 支持（用于查看长代码行）
- **语法高亮**: 多色显示

## 语法高亮颜色方案 / Syntax Highlighting Color Scheme

### 颜色映射
```
MODULE MainModule              ← 蓝色 (关键字)
    VAR num counter := 0;      ← "VAR" 蓝色, "num" 蓝灰色
    PERS robtarget home := ... ← "PERS" 蓝色, "robtarget" 蓝灰色
    
    ! 这是注释                  ← 灰色 (注释)
    
    PROC main()                ← "PROC" 蓝色, "main" 默认色
        counter := 0;          ← "0" 品红色 (数字)
        
        IF TRUE THEN           ← "IF", "THEN", "TRUE" 蓝色
            MoveJ home, v1000; ← "MoveJ" 紫色 (函数)
            TPWrite "完成";    ← "TPWrite" 紫色, "完成" 绿色 (字符串)
        ENDIF
    ENDPROC
ENDMODULE
```

### 颜色定义
| 元素类型 | 颜色代码 | 示例 |
|---------|---------|------|
| 关键字 | #0000FF (蓝色) | MODULE, PROC, IF, WHILE |
| 数据类型 | #2B91AF (蓝灰色) | num, bool, robtarget |
| 函数/指令 | #800080 (紫色) | MoveJ, MoveL, TPWrite |
| 字符串 | #008000 (绿色) | "文本内容" |
| 注释 | #808080 (灰色) | ! 注释 |
| 数字 | #FF00FF (品红色) | 123, 45.6 |
| 默认 | #000000 (黑色) | 变量名、其他 |

## 用户交互流程 / User Interaction Flow

### 打开文件流程
```
1. 启动应用
   │
   v
2. 点击 "选择 ABB 程序文件"
   │
   v
3. 系统文件选择器打开
   │
   v
4. 用户选择 .mod/.prg/.sys 文件
   │
   v
5. 应用解析文件
   │
   v
6. 显示结果:
   - 文件信息
   - 模块列表
   - 例行程序列表
   - 完整代码（带高亮）
```

### 查看例行程序流程
```
1. 文件已加载
   │
   v
2. 用户点击例行程序列表中的项目
   │
   v
3. 代码内容区域更新
   │
   v
4. 显示该例行程序的代码片段
   │
   v
5. 显示 Toast 提示: "显示例行程序: [名称]"
```

## 响应式设计 / Responsive Design

### 布局适配
- **竖屏模式**: 单列布局，卡片垂直排列
- **横屏模式**: 更宽的代码显示区域
- **平板设备**: 利用更大的屏幕空间，更多内容可见

### 滚动行为
- **主内容区**: 垂直滚动 (NestedScrollView)
- **代码区域**: 水平滚动 (HorizontalScrollView)
- **列表**: RecyclerView 内嵌滚动

## 无障碍功能 / Accessibility

- ✅ 所有可点击元素都有适当的点击区域 (最小 48dp)
- ✅ 文本对比度符合 WCAG 标准
- ✅ 支持 TalkBack 屏幕阅读器
- ✅ 可调整系统字体大小

## 性能优化 / Performance Optimization

- ✅ RecyclerView 用于列表显示（视图回收）
- ✅ 按需加载代码片段
- ✅ 高效的正则表达式匹配
- ✅ 后台线程处理文件读取

## 错误处理 / Error Handling

### 错误场景和提示

1. **不支持的文件格式**
   ```
   Toast: "不支持的文件格式。支持的格式: .mod, .prg, .sys, .pgf"
   ```

2. **文件读取错误**
   ```
   Toast: "文件读取错误: [错误信息]"
   ```

3. **权限被拒绝**
   ```
   Toast: "需要存储权限才能读取文件"
   ```

4. **空文件或无效内容**
   ```
   显示: "未选择文件"
   或: "文件内容为空"
   ```

## 主题和样式 / Theme and Styling

### 主题配置
```xml
<style name="Theme.ABB" parent="Base.Theme.ABB">
    <!-- ABB 品牌色 -->
    <item name="colorPrimary">#FF0000</item>
    <item name="colorPrimaryVariant">#CC0000</item>
    <item name="colorSecondary">#FF6600</item>
</style>
```

### 代码显示样式
```xml
<style name="CodeTextStyle">
    <item name="android:fontFamily">monospace</item>
    <item name="android:textSize">14sp</item>
    <item name="android:lineSpacingExtra">4dp</item>
</style>
```

## 使用技巧 / Usage Tips

### 💡 快速查找
1. 打开文件后，先查看模块列表了解程序结构
2. 通过例行程序列表快速定位到特定函数
3. 点击例行程序名称查看其代码实现

### 💡 阅读代码
1. 使用水平滚动查看长代码行
2. 利用语法高亮快速识别代码元素
3. 关注注释（灰色）了解代码意图

### 💡 学习建议
1. 从简单的示例程序开始
2. 对比不同的例行程序结构
3. 注意观察 RAPID 语法模式

## 快捷操作 / Quick Actions

| 操作 | 方法 |
|-----|------|
| 选择文件 | 点击主按钮 |
| 查看模块详情 | 点击模块卡片 |
| 查看例行程序 | 点击例行程序卡片 |
| 滚动代码 | 在代码区域左右滑动 |
| 返回顶部 | 向上滚动主内容区 |

## 常见界面问题 / Common UI Issues

### Q: 代码显示被截断？
A: 使用水平滚动查看完整代码行。

### Q: 找不到特定的例行程序？
A: 确保文件包含正确的 RAPID 语法，检查 PROC/FUNC/TRAP 声明。

### Q: 颜色高亮不正确？
A: 这是正常现象，语法高亮基于模式匹配，复杂语法可能需要调整。

### Q: 界面显示不全？
A: 尝试滚动屏幕，所有内容都在可滚动区域内。

---

**界面设计遵循 Material Design 3 指南，提供现代化、直观的用户体验。**
